var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,e={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var detailsub={page:1,size:10,topic:0,topicTemplate:'<div class="media"><a class="pull-left" href="javascript:;"><img class="media-object" src="%{headUrl}" alt="" width="50" height="50"></a><div class="media-body"><h4 class="media-heading">%{nickname}</h4><h6>%{createTime}</h6><div>%{content}</div>%{listImage}<div class="mui-clearfix"></div><div class="mui-pull-right"><h6 class="mui-badge mui-badge-primary mui-badge-inverted">\u8bc4\u8bba\uff08<span id="commentCount">%{commentCount}</span>\uff09</h6></div></div></div>',commentTemplate:'<li class="mui-table-view-cell"><div class="media"><a class="pull-left" href="javascript:;"><img class="media-object" src="%{headUrl}" width="35" height="35"></a><div class="media-body"><h5 class="media-heading">%{nickname}</h5><h6>%{createTime}</h6><div>%{content}</div><div class="mui-clearfix"></div><div class="mui-pull-right"><h6 class="mui-badge mui-badge-primary mui-badge-inverted"><span class="mui-icon mui-icon-chatboxes" id="%{id}" title="%{nickname}"></span></h6></div></div></div></li>',
start:function(){detailsub.before();mui.init({pullRefresh:{container:"#container",up:{contentdown:"",contentrefresh:"\u6b63\u5728\u52a0\u8f7d...",contentnomore:"\u52a0\u8f7d\u5b8c\u6bd5",callback:detailsub.pullUpRefresh}}});detailsub.after()},before:function(){},after:function(){detailsub.pReady();document.getElementById("btnSend").addEventListener("tap",function(){detailsub.comment()});document.getElementById("btnCancel").addEventListener("tap",function(){detailsub.hideEdit()})},pullUpRefresh:function(){detailsub.page+=
1;var a=this;detailsub.loadComment(function(b){b.length<detailsub.size?a.endPullupToRefresh(!0):a.endPullupToRefresh(!1)})},pReady:function(){mui.plusReady(function(){detailsub.page=1;detailsub.size=Constant.defaultPageSize;var a=plus.webview.currentWebview();detailsub.topic=a._id;detailsub.load()})},load:function(){Ajax.post(Ajax.url.topic,{id:detailsub.topic},function(a){var b="",c="",e="",d;for(d in a.listImageUrl)c+='<div class="mui-table-view-cell mui-media mui-col-sm-3"><img src="%{image}" width=60 height=60></div>'.replace("%{image}",
Constant.hostname+a.listImageUrl[d]);0!=a.listImageUrl.length&&(e='<div class="mui-table-view mui-grid-view">%{images}</div>'.replace("%{images}",c));b+=detailsub.topicTemplate.replace("%{createTime}",moment((new Date(a.createTime)).format("yyyy-MM-dd HH:mm"),"YYYY-MM-DD HH:mm").fromNow()).replace("%{headUrl}",Constant.hostname+a.clientHeadUrl).replace("%{nickname}",a.clientNickName).replace("%{content}",a.content).replace("%{commentCount}",a.commentCount).replace("%{listImage}",e);document.getElementById("topic").innerHTML=
b;detailsub.loadComment();document.querySelector(".comment-label").classList.remove("mui-hidden");document.getElementById("topic").addEventListener("tap",function(){detailsub.showEdit();detailsub.setTextareaAttribute("","\u5199\u8bc4\u8bba")})})},loadComment:function(a){Ajax.post(Ajax.url.commentList,{topicId:detailsub.topic,page:detailsub.page},function(b){var c="",e,d;for(d in b)e=Ajax.isEmpty(b[d].replyClientId)?"%{content}".replace("%{content}",b[d].content):'\u56de\u590d<span style="color: blue;"> %{replyClientNickname} </span> : %{content}'.replace("%{content}",
b[d].content).replace("%{replyClientNickname}",b[d].replyClientNickname),c+=detailsub.commentTemplate.replace("%{headUrl}",Constant.hostname+b[d].commentClientHeadUrl).replace("%{nickname}",b[d].commentClientNickname).replace("%{createTime}",moment((new Date(b[d].createTime)).format("yyyy-MM-dd HH:mm"),"YYYY-MM-DD HH:mm").fromNow()).replace("%{content}",e).replace("%{id}",b[d].commentClientId).replace("%{nickname}",b[d].commentClientNickname);jq("#commentList").append(c);detailsub.addReplyListener();
void 0!=a&&a(b)})},comment:function(){var a=document.getElementById("content"),b=a.value;if(Ajax.isEmpty(b))plus.nativeUI.toast("\u8bc4\u8bba / \u56de\u590d \u4e0d\u80fd\u4e3a\u7a7a");else{var a=a.getAttribute("title"),c=localStorage.getItem(Constant.keys.CLIENT_ID);Ajax.post(Ajax.url.commentEdit,{oper:"add",content:b,"parentTopic.id":detailsub.topic,"parentCommentClient.id":c,"parentReplyClient.id":a},function(a){detailsub.hideEdit();document.getElementById("commentList").innerHTML="";detailsub.page=
1;detailsub.loadComment();a=document.getElementById("commentCount");a.innerHTML=parseInt(a.innerHTML,10)+1})}},showEdit:function(){document.getElementById("footer").classList.remove("mui-hidden")},hideEdit:function(){document.getElementById("footer").classList.add("mui-hidden");document.getElementById("content").value=""},setTextareaAttribute:function(a,b){document.getElementById("content").setAttribute("title",a);document.getElementById("content").setAttribute("placeholder",b)},addReplyListener:function(){mui("#commentList").off("tap",
".mui-icon-chatboxes");mui("#commentList").on("tap",".mui-icon-chatboxes",function(){var a=this.getAttribute("id"),b=localStorage.getItem(Constant.keys.CLIENT_ID);a==b?plus.nativeUI.toast("\u4e0d\u80fd\u56de\u590d\u81ea\u5df1\u7684\u8bc4\u8bba"):(b=this.getAttribute("title"),detailsub.setTextareaAttribute(a,"\u56de\u590d"+b),detailsub.showEdit())})}};
