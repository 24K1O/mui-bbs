var listsub={page:1,size:10,topicTypeKey:"TOPIC_TYPE_ID",template:'<li class="mui-table-view-cell" id="%{id}"><div class="media"><a class="pull-left" href="javascript:;"><img class="media-object" src="%{headUrl}" alt="" width="48" height="48"></a><div class="media-body"><h4 class="media-heading">%{nickname}</h4><h6>%{createTime} <span class="mui-pull-right mui-badge mui-badge-primary mui-badge-inverted">\u8bc4\u8bba\uff08%{commentCount}\uff09</span></h6><div>%{content}</div><div class="mui-table-view mui-grid-view">%{images}</div></div></div></li>',
start:function(){listsub.before();mui.init({pullRefresh:{container:"#container",down:{contentdown:"\u4e0b\u62c9\u5237\u65b0",contentover:"\u91ca\u653e\u7acb\u5373\u5237\u65b0",contentrefresh:"\u6b63\u5728\u5237\u65b0...",callback:listsub.pullDownRefresh},up:{contentdown:"",contentrefresh:"\u6b63\u5728\u52a0\u8f7d...",contentnomore:"\u52a0\u8f7d\u5b8c\u6bd5",callback:listsub.pullUpRefresh}}});listsub.after()},before:function(){},after:function(){listsub.pReady();listsub.page=1;listsub.size=Constant.defaultPageSize;
listsub.load()},pullDownRefresh:function(){mui("#container").pullRefresh().refresh(!0);jq("#topicList").html("");listsub.page=1;listsub.load(function(c){mui("#container").pullRefresh().endPulldownToRefresh()})},pullUpRefresh:function(){listsub.page+=1;var c=this;listsub.load(function(a){a.length<=listsub.size?c.endPullupToRefresh(!0):c.endPullupToRefresh(!1)})},pReady:function(){mui.plusReady(function(){})},load:function(c){Ajax.post(Ajax.url.topicList,{page:listsub.page,typeId:localStorage.getItem(listsub.topicTypeKey)},
function(a){var e="",d,b;for(b in a){d="";for(var f in a[b].listImageUrl)d+='<div class="mui-table-view-cell mui-media mui-col-sm-3" id="%{id}"><img src="%{image}" width=60 height=60></div>'.replace("%{id}",a[b].id).replace("%{image}",Constant.hostname+a[b].listImageUrl[f]);e+=listsub.template.replace("%{id}",a[b].id).replace("%{createTime}",moment((new Date(a[b].createTime)).format("yyyy-MM-dd HH:mm"),"YYYY-MM-DD HH:mm").fromNow()).replace("%{headUrl}",Constant.hostname+a[b].clientHeadUrl).replace("%{nickname}",
a[b].clientNickName).replace("%{content}",a[b].content).replace("%{commentCount}",a[b].commentCount).replace("%{images}",d)}jq("#topicList").append(e);listsub.addItemListener();void 0!=c&&c(a)})},addItemListener:function(){mui(".mui-table-view").on("tap",".mui-table-view-cell",function(){var c=this.getAttribute("id");mui.openWindow({id:"detailmain.html",url:"detailmain.html",extras:{_id:c}})})}};
