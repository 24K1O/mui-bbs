var version={server:"",localDir:"version",localFile:"version.json",auto:!0,start:function(){version.server=Ajax.url.version;plus.io.requestFileSystem(plus.io.PRIVATE_DOC,function(a){a.root.getDirectory(version.localDir,{create:!0},function(a){version.dir=a;version.check()},function(a){console.log(a.message)})},function(a){console.log(a.message)})},check:function(){var a=plus.storage.getItem(version.keyUpdate);if(a){a=parseInt(a);if((new Date).getTime()-a<version.checkInterval)return;plus.storage.removeItem(version.keyUpdate)}version.dir.getFile(version.localFile,
{create:!1},function(a){a.file(function(b){var c=new plus.io.FileReader;c.onloadend=function(b){a.remove();var c=null;try{c=JSON.parse(b.target.result)}catch(g){return}version.checkData(c)};c.readAsText(b)},function(b){a.remove()})},function(a){version.getJson()})},getJson:function(){var a=new plus.net.XMLHttpRequest;a.onreadystatechange=function(){switch(a.readyState){case 4:200==a.status&&version.dir.getFile(version.localFile,{create:!0},function(d){d.createWriter(function(b){b.onerror=function(){};
b.write(a.responseText)},function(a){})},function(a){})}};a.open("GET",version.server);a.send()},checkData:function(a){var d=plus.runtime.version;if(inf=a[plus.os.name]){a=inf.version;var b=plus.storage.getItem(version.keyAbort);b&&a==b||version.compareVersion(d,a)&&plus.nativeUI.confirm(inf.note,function(a){1==a.index?plus.runtime.openURL(inf.url):plus.storage.setItem(version.keyUpdate,(new Date).getTime().toString())},inf.title,["\u53d6\u3000\u3000\u6d88","\u7acb\u5373\u66f4\u65b0"])}},compareVersion:function(a,
d){var b="\u5f53\u524d\u7248\u672c\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c\uff08"+plus.runtime.version+"\uff09";if(!a||!d||""==a||""==d)return version.auto||plus.nativeUI.alert(b,function(){},"\u63d0\u793a","\u786e\u5b9a"),!1;for(var c=a.split(".",4),f=d.split(".",4),e=0;e<c.length&&e<f.length;e++){var g=c[e],h=parseInt(g),k=f[e],l=parseInt(k);if(l>h||k.length>g.length)return!0;if(l<h)return version.auto||plus.nativeUI.alert(b,function(){},"\u63d0\u793a","\u786e\u5b9a"),!1}if(f.length>c.length&&
0==d.indexOf(a))return!0}};
